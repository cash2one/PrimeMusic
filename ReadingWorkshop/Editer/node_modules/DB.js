var MongoClient = require('mongodb').MongoClient;
var Server = require('mongodb').Server;
var util = require('util');

function DB() {
    this.name = 'mongoBD';
}

DB.prototype.find_word_group_list = function(word, callback) {
    var conf = require('./conf.js');
    var mongo_client = new MongoClient(new Server(conf['ip'], conf['port']));
    mongo_client.open(function(err, mongo_client){
            if (err) {
                mongo_client.close();
                return callback([]);
            }
            var db = mongo_client.db(conf['db']);
            var collection = db.collection(conf['collection']);
            collection.find({'word_list.word': word}).toArray(function(err, document_list){
                mongo_client.close();
                if (err) {
                    return callback([]);
                }
                return callback(document_list);
                }); 
            }); 
    
}

DB.prototype.remove_one_word_group = function(word_group, callback) {
    var conf = require('./conf.js');
    var mongo_client = new MongoClient(new Server(conf['ip'], conf['port']));
    mongo_client.open(function(err, mongo_client){
            if (err) {
                mongo_client.close();
                return callback(0);
            }
            var db = mongo_client.db(conf['db']);
            var collection = db.collection(conf['collection']);
            collection.remove({arg: word_group['arg']}, {w: 1}, function(err, result){
                mongo_client.close();
                if (err) {
                   return callback(0);
                }
                return callback(result);
                });
            });
}

DB.prototype.update_one_word_group = function(word_group, callback){
    var conf = require('./conf.js');
    var mongo_client = new MongoClient(new Server(conf['ip'], conf['port']));
    mongo_client.open(function(err, mongo_client){
            if (err){
                mongo_client.close();
                return callback(0);
            }
            var db = mongo_client.db(conf['db']);
            var collection = db.collection(conf['collection']);
            collection.update({arg: word_group['arg']}, word_group, {w: 1}, function(err, result){
                mongo_client.close();
                if (err){
                    return callback(0);
                }
                return callback(result);
                });
            });
}

module.exports = DB;

test = function(list) {
    console.log(list.length);
    for (var i = 0; i < list.length; i += 1) {
        console.log(list[i]);
    }
}

db = new DB();
db.find_word_group_list('relinquish', test);

